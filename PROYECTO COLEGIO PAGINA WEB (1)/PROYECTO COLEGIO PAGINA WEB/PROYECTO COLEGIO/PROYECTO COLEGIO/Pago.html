<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscar Libros - Biblioteca Universitaria</title>
    <link rel="stylesheet" href="Pago.css">
    <link rel="icon" href="img/Logo.png" type="image/png">
    <link rel="user" href="img/user.svg" type="image/svg">
</head>

<body>
    <header>
        <img src="img/Logo.png" alt="Logo" class="logo">
        <nav>
            <a href="home.html" id="linkact">HOME</a>
            <a href="home.html" id="linkc">¿Quiénes somos?</a>
        </nav>
    </header>
    <div class="container">
        <div class="sidebar">
            <img src="img/user.svg" alt="User" class="user">
            <nav>
                <a>Usuario: xxxxxxx</a>
            </nav>
            <button class="sidebar-button"><a href="Matricular.html"
                    style="text-decoration: none; color: inherit;">Matricular</a></button>
            <button class="sidebar-button"><a href="Horario.html" style="text-decoration: none; color: inherit;">Generar
                    Horario</a></button>
            <button class="sidebar-button"><a href="Pago.html" style="text-decoration: none; color: inherit;">Realizar
                    Pago</a></button>
            <button class="sidebar-button logout">Cerrar Sesión</button>
        </div>
        <div class="content">
            <section class="realizar-pago" id="realizar-pago">
                <h2>Realizar Pago</h2>
                <form id="search-form">
                <div class="form-group">
                    <div>
                        <label for="cro_id">ID de Pago:</label>
                        <input type="number" id="cro_id" name="cro_id" required>
                    </div>
                    <div style="height: 20px; visibility: hidden;"></div>
                    <div>
                        <label for="emp_id">ID de Empleado:</label>
                        <input type="number" id="emp_id" name="emp_id" required>
                    </div>
                    <div style="height: 20px; visibility: hidden;"></div>
                    <div>
                        <label for="pag_importe">Monto de Pago:</label>
                        <input type="number" id="pag_importe" name="pag_importe" required>
                    </div>
                    <div style="height: 20px; visibility: hidden;"></div>
                    <div>
                        <label for="pag_fecha">Fecha:</label>
                        <input type="text" id="pag_fecha" name="pag_fecha" required>
                    </div>
                </div>
                <button type="submit" class="search-button">Confirmar</button>
                </form>
                <div id="resultado"></div>
            </section>
        </div>
    </div>
    <script>
        // Función para obtener la fecha actual en formato dd/mm/yyyy
        function obtenerFechaActual() {
            const ahora = new Date();
            const dia = String(ahora.getDate()).padStart(2, '0'); // Asegura dos dígitos
            const mes = String(ahora.getMonth() + 1).padStart(2, '0'); // Meses comienzan en 0
            const anio = ahora.getFullYear();
            return `${dia}/${mes}/${anio}`;
        }
        // Manejo del envío del formulario
        const formulario = document.getElementById('realizar-pago');
        formulario.addEventListener('submit', function (event) {
            event.preventDefault(); // Evita el envío predeterminado del formulario

            // Capturar valores de los campos
            const matFecha = obtenerFechaActual();
            const datos = {
                cro_id: parseInt(document.getElementById('cro_id').value.trim(), 10),
                emp_id: parseInt(document.getElementById('emp_id').value.trim(), 10),
                pag_importe: parseFloat(document.getElementById('pag_importe').value.trim(), 10),
                pag_fecha: document.getElementById('pag_fecha').value.trim(),
            };


            // Enviar los datos al servidor
            const apiUrl = `http://localhost:8080/api/colegio/pago`;
            console.log("Datos enviados:", JSON.stringify({ alu_id: datos.alu_id, sec_id: datos.sec_id, emp_id: datos.emp_id, mat_tipo: datos.mat_tipo, mat_fecha: datos.mat_fecha }));
            console.log("Datos enviados:", JSON.stringify(datos));
            fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(datos)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Error: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const resultadoDiv = document.getElementById('resultado'); // Contenedor para mostrar los resultados
            resultadoDiv.innerHTML = `
                <table border="1">
                    <thead>
                        <tr>
                            <th>ID Pago</th>
                            <th>Empleado ID</th>
                            <th>Importe ID</th>
                            <th>Fecha</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>${data.cro_id}</td>
                            <td>${data.emp_id}</td>
                            <td>${data.pag_importe}</td>
                            <td>${data.pag_fecha}</td>
                        </tr>
                    </tbody>
                </table>
                <p>Pago realizado exitosamente.</p>
            `;
        })
        .catch(error => {
            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.innerHTML = `<p style="color: red;">Error al realizar el pago: ${error.message}</p>`;
        });
    });
    </script>
</body>

</html>